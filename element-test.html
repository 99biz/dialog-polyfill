<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
.long {
  background: blue;
  width: 20px;
  height: 400px;
  margin: 1em;
}
.box {
  background: white;
  border: solid;
  padding: 1em;
}
.box::before {
  content: '';
  z-index: -1;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.1);
}
  </style>
</head>
<body>

<h1 id="title"></h1>
<header>
  <a href="?">Use default</a>
  <a href="?polyfill">Force polyfill</a>
</header>

<script type="module">
  import polyfillElement from './src/element.js';
  import nativeElement from './src/element-native.js';

  if (!window.HTMLDialogElement || location.search === '?polyfill') {
    customElements.define('x-dialog', polyfillElement);
    title.textContent = 'Polyfill demo';
  } else {
    customElements.define('x-dialog', nativeElement);
    title.textContent = 'Native demo';
  }

  const d = document.getElementById('dialog');
  showModal.addEventListener('click', () => {
    d.showModal();
  });
  show.addEventListener('click', () => {
    d.show();
  });

  const innerRoot = innerDiv.attachShadow({mode: 'open'});
  innerRoot.innerHTML = `
  <x-dialog id="innerDialog">
    <input type="search" placeholder="In shadow root" />
    <slot></slot>
  </x-dialog>
  `;
  innerOpen.addEventListener('click', () => {
    innerRoot.querySelector('#innerDialog').showModal();
  });

  showOtherModal.onclick = () => dialogOther.showModal();

  focusOuter.onclick = () => {
    outerText.focus();
  };

  focusBefore.onclick = () => thingBefore.focus();
  focusAfter.onclick = () => thingAfter.focus();

  document.addEventListener('submit', (e) => {
    console.warn('document submit', e.target, e.submitter);
  });

</script>

<textarea tabindex="0" id="outerText">Who knows</textarea>

<div id="thingBefore" tabindex="0">I'm before the dialogs</div>

<x-dialog id="dialog">
  <div id="innerDiv">
    <div class="box">
      within the inner dialog
      <div id="focusable" tabindex="0" autofocus>Focusable?</div>

      <input type="text" placeholder="inner" />
    </div>
  </div>

  <div class="box">
    <textarea>Stuff</textarea>
    Hello, I'm probably a dialog dialog

    <button id="focusOuter">Focus on outer textarea</button>

    <input type="text" placeholder="ti-b" tabindex="10" autofocus disabled />
    <input type="text" placeholder="ti-a" tabindex="20" autofocus />
    <button id="innerOpen" tabindex="100">Open inner dialog</button>

    <button id="focusBefore">Focus before</button>
    <button id="focusAfter">Focus after</button>
  </div>
</x-dialog>

<dialog id="realDialog">
  I'm a real dialog
  <form method="dialog">
    <button>Button to submit the dialog form</button>
    <input type="submit" value="Submit button" />
  </form>
</dialog>

<x-dialog id="dialogOther">
  I'm another, different dialog
  <form method="dialog">
    <button>Button to submit the dialog form</button>
    <input type="submit" value="Submit button" />
  </form>
  <form method="post">
    <button>Button to submit the regular form</button>
    <input type="submit" value="Submit button" />
  </form>
</x-dialog>

<button id="show">show</button>
<button id="showModal" tabindex="15">showModal</button>
<button id="showOtherModal">showOtherModal</button>

<div id="thingAfter" tabindex="0">I'm after the dialogs</div>

<div class="long"></div>
<div class="long"></div>
<div class="long"></div>
<div class="long"></div>

</body>
</html>
